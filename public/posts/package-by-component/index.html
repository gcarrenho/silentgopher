<!DOCTYPE html>
<html lang="es" data-theme="">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
  <title>Parte 2: Aplicando Component-Based Clean Architecture en Go</title>
  
  <link rel="stylesheet" href="/scss/main.min.c6663d93d404c52f5be37021224d6c75bb16a53200683e3143b1d6ccb9b93505.css" integrity="sha256-xmY9k9QExS9b43AhIk1sdbsWpTIAaD4xQ7HWzLm5NQU=">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
</head>
  <body data-post-id="package-by-component" class="post-page">
  <header class="main-header">
    <img src="/images/posts/package-by-component.png" 
       alt="Parte 2: Aplicando Component-Based Clean Architecture en Go" 
       class="header-gopher">
    <button class="theme-toggle" aria-label="Cambiar tema">ğŸŒ™</button>
  </header>

  <nav style="text-align:center; margin-top:1rem;">
    <a href="/">Inicio</a> |
    <a href="/posts">ArtÃ­culos</a> |
    <a href="/about">Sobre mÃ­</a>
  </nav>

  <main class="medium-article ">
    <article>
      <h1>Parte 2: Aplicando Component-Based Clean Architecture en Go</h1>
      
        <h2 class="subtitle">Package by Components</h2>
      

      
      <div class="engagement-stats">
        <span class="stat-item">
          â±ï¸ <span class="minutes">4</span> min
        </span>
        â€¢
        <span class="stat-item">
          ğŸ‘ï¸ <span id="view-count">0</span>
        </span>
        â€¢
        <button id="clap-btn" class="clap-button" aria-label="Aplaudir este artÃ­culo">
          ğŸ‘ <span id="clap-count">0</span>
        </button>
        â€¢
        <button id="comment-btn" class="comment-button" aria-label="Comentar este artÃ­culo">
          ğŸ’¬ <span id="comment-count">0</span>
        </button>
      </div>

  </div> 
        <p class="meta-info">
          June 14, 2025 â€” por @SilentGopher
        </p>
      
      <div class="content">
        <blockquote>
<p>ğŸ’¡ ADVERTENCIA: Si esperas copy-paste perfecto, mejor ve a StackOverflow.
Esto es cÃ³digo real con cicatrices, donde el 60% funcionÃ³ al primer intento y el otro 40% nos hizo llorar en el refactor.</p></blockquote>
<h2 id="-el-proyecto-que-casi-me-quema-los-pÃ¡rpados">ğŸš§ El Proyecto que casi me Quema los PÃ¡rpados</h2>
<p>Hace varios meses, heredÃ© un monolito en Go donde:</p>
<ul>
<li>
<p><code>users</code> y <code>orders</code> compartÃ­an structs como si fueran confesiones de borrachos.</p>
</li>
<li>
<p>Un cambio en <code>User.Email</code> rompÃ­a 3 servicios distintos.</p>
</li>
<li>
<p>Los tests eran tan frÃ¡giles como cristal de Murano.</p>
</li>
</ul>
<p><strong>Hoy te muestro cÃ³mo lo convertimos en esto</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#a6e22e">cmd</span><span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span><span style="color:#a6e22e">internal</span><span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">users</span><span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">payments</span><span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">orders</span><span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">contracts</span><span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">web</span><span style="color:#f92672">/</span>
</span></span></code></pre></div><h2 id="-paso-1-el-contrato---nuestro-tinder-tÃ©cnico">ğŸ”— Paso 1: El Contrato - Nuestro &ldquo;Tinder&rdquo; TÃ©cnico</h2>
<p>En lugar de que <code>payments</code> stalkee a <code>users</code>, creamos un contrato explÃ­cito:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// contracts/user/user_service.go</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">user</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Service</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">GetUserByID</span>(<span style="color:#a6e22e">id</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">UserDTO</span>, <span style="color:#66d9ef">error</span>)  <span style="color:#75715e">// Solo 1 mÃ©todo. Â¡Como un buen microservicio!</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">UserDTO</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ID</span>    <span style="color:#66d9ef">string</span>  <span style="color:#75715e">// Justo lo necesario</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Email</span> <span style="color:#66d9ef">string</span>  <span style="color:#75715e">// Nada de &#34;PasswordHash&#34; aquÃ­</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Â¿Por quÃ© esto es mÃ¡gico?</p>
<ul>
<li>
<p><code>payments</code> declara: &ldquo;Necesito esto&rdquo;.</p>
</li>
<li>
<p>users responde: &ldquo;Te lo doy, pero no me preguntes cÃ³mo&rdquo;.</p>
</li>
<li>
<p><strong>Divorcio saludable</strong>: Si maÃ±ana <code>users</code> cambia de MySQL a CSV, a nadie le importa.</p>
</li>
</ul>
<h2 id="-paso-2-implementando-users-con-errores-incluidos">ğŸ‘· Paso 2: Implementando <code>users</code> (con errores incluidos)</h2>
<p>AquÃ­ estÃ¡ el cÃ³digo real que usamos (con el bug que dejamos pasar a prod):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// internal/users/adapters/service.go</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">UserService</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">repo</span> <span style="color:#a6e22e">UserRepository</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">UserService</span>) <span style="color:#a6e22e">GetUserByID</span>(<span style="color:#a6e22e">id</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">UserDTO</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">u</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">repo</span>.<span style="color:#a6e22e">FindByID</span>(<span style="color:#a6e22e">id</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">UserDTO</span>{}, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;no encontrÃ© al usuario %s: %w&#34;</span>, <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// ğŸ’¥ Error: No registramos el fallo. Lo aprendimos despuÃ©s.</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">UserDTO</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ID</span>:    <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">ID</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Email</span>: <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">Email</span>,  <span style="color:#75715e">// &lt;- Â¡Seguro que es vÃ¡lido? (Spoiler: No siempre)</span>
</span></span><span style="display:flex;"><span>	}, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>LecciÃ³n aprendida</strong>:
Los contratos no eliminan errores, pero contienen el daÃ±o. AquÃ­, aunque <code>UserService</code> fallara:</p>
<ol>
<li>
<p><code>payments</code> no se enteraba de campos internos como <code>u.FailedLoginAttempts</code>.</p>
</li>
<li>
<p>El error era claro y manejable.</p>
</li>
</ol>
<h2 id="-paso-3-payments---el-cliente-exigente">ğŸ’¸ Paso 3: payments - El Cliente Exigente</h2>
<p>AsÃ­ consume el contrato (con un gotcha que no vimos venir):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// components/payments/payment_component_impl/service.go</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">PaymentComponentImpl</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">userService</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Service</span>  <span style="color:#75715e">// &lt;- Depende del CONTRATO, no de users</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PaymentComponentImpl</span>) <span style="color:#a6e22e">Charge</span>(<span style="color:#a6e22e">userID</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">amount</span> <span style="color:#66d9ef">float64</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">u</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">userService</span>.<span style="color:#a6e22e">GetUserByID</span>(<span style="color:#a6e22e">userID</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;fallÃ³ el pago para %s: %w&#34;</span>, <span style="color:#a6e22e">userID</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">Email</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {  <span style="color:#75715e">// ğŸ’¡ Â¡ValidaciÃ³n donde DEBE estar!</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;email requerido para pagos&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// ... lÃ³gica de Stripe/PayPal</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Â¿QuÃ© pasÃ³ en producciÃ³n?</strong></p>
<p>Descubrimos que algunos usuarios tenÃ­an <code>Email == &quot;&quot;</code> (mala validaciÃ³n inicial).</p>
<p><strong>Gracias al contrato</strong>: El bug estuvo aislado en <code>users.payments</code> solo vio datos invÃ¡lidos, no campos corruptos.</p>
<h2 id="-wiring-en-maingo---el-me-caso-del-cÃ³digo">âš¡ Wiring en main.go - El &ldquo;Me Caso&rdquo; del CÃ³digo</h2>
<p>AquÃ­ es donde todo se une (o explota, si lo haces mal):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// cmd/main.go</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">cancel</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">WithCancel</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">cancel</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">wg</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>{}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">router</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">container</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">NewAppContainer</span>() <span style="color:#75715e">// Crea todos los componente inyectando su respectiva base de datos.</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">routes</span>.<span style="color:#a6e22e">Register</span>(<span style="color:#a6e22e">router</span>, <span style="color:#a6e22e">container</span>) <span style="color:#75715e">// registra todas las rutas</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">router</span>, <span style="color:#a6e22e">wg</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sig</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Signal</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">signal</span>.<span style="color:#a6e22e">Notify</span>(<span style="color:#a6e22e">sig</span>, <span style="color:#a6e22e">syscall</span>.<span style="color:#a6e22e">SIGINT</span>, <span style="color:#a6e22e">syscall</span>.<span style="color:#a6e22e">SIGTERM</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">sig</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">cancel</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Wait</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Orquesta components initializing and dependency injection</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">app</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">AppContainer</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">OrderComponent</span>   <span style="color:#a6e22e">orders</span>.<span style="color:#a6e22e">OrderComponent</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">PaymentComponent</span> <span style="color:#a6e22e">payments</span>.<span style="color:#a6e22e">PaymentComponent</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">UserComponent</span>    <span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">UserComponent</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewAppContainer</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">AppContainer</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">AppContainer</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">OrderComponent</span>: <span style="color:#a6e22e">orders</span>.<span style="color:#a6e22e">NewOrderComponentImpl</span>(<span style="color:#a6e22e">orders</span>.<span style="color:#a6e22e">Deps</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">DB</span>: <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">InitMySQL</span>(),
</span></span><span style="display:flex;"><span>		}),
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">PaymentComponent</span>: <span style="color:#a6e22e">payments</span>.<span style="color:#a6e22e">NewPaymentComponentImpl</span>(<span style="color:#a6e22e">payments</span>.<span style="color:#a6e22e">Deps</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">DB</span>: <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">InitPostgres</span>(),
</span></span><span style="display:flex;"><span>		}),
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">UserComponent</span>: <span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">NewUserComponentImpl</span>(<span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">Deps</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">DB</span>: <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">InitMySQL</span>(),
</span></span><span style="display:flex;"><span>		}),
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Orquesta controladores</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">routes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Register</span>(<span style="color:#a6e22e">router</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>, <span style="color:#a6e22e">container</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">AppContainer</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">api</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">Group</span>(<span style="color:#e6db74">&#34;/api&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Public (sin auth)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">public</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">Group</span>(<span style="color:#e6db74">&#34;/public&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Private (con auth middleware)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">private</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">Group</span>(<span style="color:#e6db74">&#34;/private&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">private</span>.<span style="color:#a6e22e">Use</span>(<span style="color:#a6e22e">AuthMiddleware</span>())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Payments</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">paymentController</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">web</span>.<span style="color:#a6e22e">NewPaymentController</span>(<span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">PaymentComponent</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">paymentController</span>.<span style="color:#a6e22e">RegisterRoutes</span>(<span style="color:#a6e22e">private</span>.<span style="color:#a6e22e">Group</span>(<span style="color:#e6db74">&#34;/payments&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Orders</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">orderController</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">web</span>.<span style="color:#a6e22e">NewOrderController</span>(<span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">OrderComponent</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">orderController</span>.<span style="color:#a6e22e">RegisterRoutes</span>(<span style="color:#a6e22e">public</span>.<span style="color:#a6e22e">Group</span>(<span style="color:#e6db74">&#34;/orders&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Users</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">userController</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">web</span>.<span style="color:#a6e22e">NewUserController</span>(<span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">UserComponent</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">userController</span>.<span style="color:#a6e22e">RegisterRoutes</span>(<span style="color:#a6e22e">private</span>.<span style="color:#a6e22e">Group</span>(<span style="color:#e6db74">&#34;/users&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Health</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/health&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">JSON</span>(<span style="color:#ae81ff">200</span>, <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">H</span>{<span style="color:#e6db74">&#34;status&#34;</span>: <span style="color:#e6db74">&#34;ok&#34;</span>})
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>MetÃ¡fora clave:</p>
<blockquote>
<p><code>users/adapters/service.go</code> es como un traductor profesional. <code>payments</code> habla en &ldquo;necesito un usuario&rdquo;, y el traductor convierte eso al dialecto interno de <code>users</code>. Si <code>users</code> cambia su idioma, solo el traductor debe actualizarse.</p></blockquote>
<h2 id="-y-si-no-usamos-contratos-el-caos-que-vivimos">ğŸ’£ Â¿Y si No Usamos Contratos? (El Caos que Vivimos)</h2>
<p>Te muestro el before/after de nuestro cÃ³digo real:</p>
<h3 id="-antes-acoplamiento-criminal">ğŸš« Antes (Acoplamiento Criminal)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// internal/payments/payment_component_impl.go (OLD)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PaymentService</span>) <span style="color:#a6e22e">Refund</span>(<span style="color:#a6e22e">userID</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">u</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">userRepo</span>.<span style="color:#a6e22e">GetUser</span>(<span style="color:#a6e22e">userID</span>)  <span style="color:#75715e">// Â¡Acceso directo al repo de users!</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">CreditCard</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {  <span style="color:#75715e">// ğŸ’¥ Campo interno que cambiÃ³ 3 veces</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;no tiene tarjeta&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="-despuÃ©s-contratos-al-rescate">âœ… DespuÃ©s (Contratos al Rescate)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// contracts/user/service.go (NEW)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Service</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">GetUserForPayment</span>(<span style="color:#a6e22e">id</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">PaymentUserDTO</span>, <span style="color:#66d9ef">error</span>)  <span style="color:#75715e">// Â¡Ahora el contrato es explÃ­cito!</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// internal/payments/service.go (NEW)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PaymentService</span>) <span style="color:#a6e22e">Refund</span>(<span style="color:#a6e22e">userID</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">u</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">userService</span>.<span style="color:#a6e22e">GetUserForPayment</span>(<span style="color:#a6e22e">userID</span>)  <span style="color:#75715e">// Solo lo que NECESITA</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// ...</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Beneficios concretos</strong>:</p>
<ol>
<li>
<p>Cuando <code>users</code> cambiÃ³ su modelo de tarjetas, <code>payments</code> ni se enterÃ³.</p>
</li>
<li>
<p>Los tests de <code>payments</code> usan un mock de 10 lÃ­neas, no una DB falsa.</p>
</li>
</ol>
<h2 id="-conclusiÃ³n-menos-teorÃ­a-mÃ¡s-superpoderes">ğŸ“Œ ConclusiÃ³n: Menos TeorÃ­a, MÃ¡s Superpoderes</h2>
<p>Esta arquitectura nos permitiÃ³:</p>
<ul>
<li>
<p>Mover <code>users</code> a otro repo sin tocar <code>payments</code>.</p>
</li>
<li>
<p>Refactorizar la DB 3 veces sin pÃ¡nico.</p>
</li>
<li>
<p>Onboardear devs nuevos con: &ldquo;Â¿Necesitas datos de X? Mira sus contratos&rdquo;.</p>
</li>
</ul>
<blockquote>
<p>&ldquo;Clean Architecture no se trata de carpetas perfectas, sino de poder dormir sabiendo que el cambio de maÃ±ana no te arruinarÃ¡ la semana.&rdquo;</p></blockquote>
<p>ğŸ’¬ Â¿Vos tambiÃ©n has lidiado con acoplamientos?
Contame en los comments.</p>

      </div>
      
      
     
        
         
      </div>

  

<section class="all-comments">
  <div class="comments-header">
    <h3>ConversaciÃ³n</h3>
    <div class="comment-count">
      ğŸ’¬ <span id="comment-count-section">0</span> comentarios
    </div>
  </div>

  
  <div id="login-container" class="login-container" style="display: none;">
    <p>Debes iniciar sesiÃ³n con GitHub para comentar</p>
    <button id="login-github-btn" class="login-github-btn">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.166 6.839 9.489.5.09.682-.218.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.578 9.578 0 0112 6.836c.85.004 1.705.114 2.504.336 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.202 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.163 22 16.418 22 12c0-5.523-4.477-10-10-10z"></path>
      </svg>
      Iniciar sesiÃ³n con GitHub
    </button>
  </div>

  
  <form id="main-comment-form" class="comment-form" style="display: none;">
    <div class="avatar-placeholder">
      <img id="main-user-avatar-img" src="https://www.gravatar.com/avatar/?d=mp&s=40" class="avatar-img">
    </div>
    <div class="form-content">
      <textarea placeholder="Escribe tu comentario..." rows="3" required></textarea>
      <div class="form-actions">
        <button type="submit" class="submit-button">Publicar</button>
      </div>
    </div>
    <input type="hidden" id="reply-to" value="">
  </form>
</section>

    </article>
  </main>

  <script>
document.addEventListener('DOMContentLoaded', () => {
    
    const themeToggles = document.querySelectorAll('.theme-toggle');
    
    
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const currentTheme = localStorage.getItem('theme');

    
    if (currentTheme === 'dark' || (!currentTheme && prefersDark)) {
        document.documentElement.setAttribute('data-theme', 'dark');
        themeToggles.forEach(btn => btn.textContent = 'â˜€ï¸');
    } else {
        document.documentElement.setAttribute('data-theme', 'light');
        themeToggles.forEach(btn => btn.textContent = 'ğŸŒ™');
    }

    
    themeToggles.forEach(button => {
        button.addEventListener('click', () => {
            const current = document.documentElement.getAttribute('data-theme');
            if (current === 'light') {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggles.forEach(btn => btn.textContent = 'â˜€ï¸');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                themeToggles.forEach(btn => btn.textContent = 'ğŸŒ™');
                localStorage.setItem('theme', 'light');
            }
        });
    });

    
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
        if (!localStorage.getItem('theme')) {
            const newTheme = e.matches ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            themeToggles.forEach(btn => btn.textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™');
        }
    });
});
</script>


<script>
  const postId = "posts\/package-by-component.md"; 
  const countKey = `claps-${postId}`;
  const countDisplay = document.getElementById("clap-count");
  const button = document.getElementById("clap-button");

  const saved = localStorage.getItem(countKey);
  let count = saved ? parseInt(saved) : 0;
  if (countDisplay) countDisplay.textContent = count;

  if (button) {
    button.addEventListener("click", () => {
      count += 1;
      countDisplay.textContent = count;
      localStorage.setItem(countKey, count);
    });
  }
</script>


  
  <script type="module" src="/js/main.js"></script>
</body>
</html>